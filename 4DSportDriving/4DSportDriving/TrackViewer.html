<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
</head>
<body>
    <canvas id="circuit" height="480" width="480"></canvas>
    <div id="test"></div>
    <script type="text/javascript">
        function readBlob(blob) {
            var reader = new FileReader();
            reader.onloadend = onloadendHandler;
            reader.onerror = errorHandler;
            reader.readAsArrayBuffer(blob); // Read the file asynchronously and use callbacks to handle necessary actions.
        }

        // ---------------------------------------------------------------------------------------------------------

        function onloadendHandler(evt) {
            if (evt.target.readyState == FileReader.DONE) {
                content = new Int8Array(evt.target.result);

                var circuitCanvas = document.getElementById("circuit");
                var context = circuitCanvas.getContext('2d');
                //render terrain
                for (var i = 0; i < 900; i++) {
                    x = i % 30;
                    y = Math.floor(i / 30);

                    var value = content[i + 901];
                    var img = terrains[value];
                    if (img != null) {
                        context.drawImage(img, x * 16, y * 16);
                    }
                }
                //render circuit
                for (var i = 0; i < 900; i++) {
                    x = i % 30;
                    y = 29 - Math.floor( i / 30);

                    var value = content[i];
                    var img = circuits[value];
                    if (img != null) {
                        context.drawImage(img, x * 16, y * 16);
                    }
                }

            }
        }

        function errorHandler(evt) {
            if (evt.target.error.name == "NotReadableError") {
                document.getElementById('alert').innerHTML = 'The file could not be read.';
            }
            else {
                document.getElementById('alert').innerHTML = 'File error.';
            }
        }

        //readBlob("toto".slice(0, 4));

        var terrains = {
            0x00 : "0x00.png",
            0x01 : "0x01.png",
            0x02 : "0x02.png",
            0x03 : "0x03.png",
            0x04 : "0x04.png",
            0x05 : "0x05.png",
            0x06 : "0x06.png",
            0x07 : "0x07.png",
            0x08 : "0x08.png",
            0x09 : "0x09.png",
            0x0a : "0x0a.png",
            0x0b : "0x0b.png",
            0x0c : "0x0c.png",
            0x0d : "0x0d.png",
            0x0e : "0x0e.png",
            0x0f : "0x0f.png",
            0x10 : "0x10.png",
            0x11 : "0x11.png",
            0x12 : "0x12.png",
        }
        for (var i in terrains) {
            var img = new Image();
            img.src = "Graphics/terrain/" + terrains[i];
            terrains[i] = img;
        }

        var circuits = {
            0x01 : "0x01.png",
            0x04 : "0x04.png",
            0x05 : "0x05.png",
            0x06 : "0x06.png",
            0x07 : "0x07.png",
            0x08 : "0x08.png",
            0x09 : "0x09.png",
            0x0a : "0x0a.png",
            0x0b : "0x0b.png",
            0x0c : "0x0c.png",
            0x0d : "0x0d.png",
            0x0e : "0x0e.png",
            0x0f : "0x0f.png",
            0x10 : "0x10.png",
            0x11 : "0x11.png",
            0x12 : "0x12.png",
            0x13 : "0x13.png",
            0x14 : "0x14.png",
            0x15 : "0x15.png",
            0x16 : "0x16.png",
            0x17 : "0x17.png",
            0x18 : "0x18.png",
            0x19 : "0x19.png",
            0x1a : "0x1a.png",
            0x1b : "0x1b.png",
            0x1c : "0x1c.png",
            0x1d : "0x1d.png",
            0x1e : "0x1e.png",
            0x1f : "0x1f.png",
            0x20 : "0x20.png",
            0x21 : "0x21.png",
            0x22 : "0x22.png",
            0x23 : "0x23.png",
            0x24 : "0x24.png",
            0x25 : "0x25.png",
            0x26 : "0x26.png",
            0x27 : "0x27.png",
            0x28 : "0x28.png",
            0x29 : "0x29.png",
            0x2a : "0x2a.png",
            0x2b : "0x2b.png",
            0x2c : "0x2c.png",
            0x2d : "0x2d.png",
            0x2e : "0x2e.png",
            0x2f : "0x2f.png",
            0x30 : "0x30.png",
            0x31 : "0x31.png",
            0x32 : "0x32.png",
            0x33 : "0x33.png",
            0x34 : "0x34.png",
            0x35 : "0x35.png",
            0x36 : "0x36.png",
            0x37 : "0x37.png",
            0x38 : "0x38.png",
            0x39 : "0x39.png",
            0x3a : "0x3a.png",
            0x3b : "0x3b.png",
            0x3c : "0x3c.png",
            0x3d : "0x3d.png",
            0x3e : "0x3e.png",
            0x3f : "0x3f.png",
            0x40 : "0x40.png",
            0x41 : "0x41.png",
            0x42 : "0x42.png",
            0x43 : "0x43.png",
            0x44 : "0x44.png",
            0x45 : "0x45.png",
            0x46 : "0x46.png",
            0x47 : "0x47.png",
            0x48 : "0x48.png",
            0x49 : "0x49.png",
            0x4a : "0x4a.png",
            0x4b : "0x4b.png",
            0x4c : "0x4c.png",
            0x4d : "0x4d.png",
            0x4e : "0x4e.png",
            0x4f : "0x4f.png",
            0x50 : "0x50.png",
            0x51 : "0x51.png",
            0x52 : "0x52.png",
            0x53 : "0x53.png",
            0x54 : "0x54.png",
            0x55 : "0x55.png",
            0x56 : "0x56.png",
            0x57 : "0x57.png",
            0x58 : "0x58.png",
            0x59 : "0x59.png",
            0x5a : "0x5a.png",
            0x5b : "0x5b.png",
            0x5c : "0x5c.png",
            0x5d : "0x5d.png",
            0x5e : "0x5e.png",
            0x5f : "0x5f.png",
            0x60 : "0x60.png",
            0x61 : "0x61.png",
            0x62 : "0x62.png",
            0x63 : "0x63.png",
            0x64 : "0x64.png",
            0x65 : "0x65.png",
            0x66 : "0x66.png",
            0x67 : "0x67.png",
            0x68 : "0x68.png",
            0x69 : "0x69.png",
            0x6a : "0x6a.png",
            0x6b : "0x6b.png",
            0x6c : "0x6c.png",
            0x6d : "0x6d.png",
            0x6e : "0x6e.png",
            0x6f : "0x6f.png",
            0x70 : "0x70.png",
            0x71 : "0x71.png",
            0x72 : "0x72.png",
            0x73 : "0x73.png",
            0x74 : "0x74.png",
            0x75 : "0x75.png",
            0x76 : "0x76.png",
            0x77 : "0x77.png",
            0x78 : "0x78.png",
            0x79 : "0x79.png",
            0x7a : "0x7a.png",
            0x7b : "0x7b.png",
            0x7c : "0x7c.png",
            0x7d : "0x7d.png",
            0x7e : "0x7e.png",
            0x7f : "0x7f.png",
            0x80 : "0x80.png",
            0x81 : "0x81.png",
            0x82 : "0x82.png",
            0x83 : "0x83.png",
            0x84 : "0x84.png",
            0x85 : "0x85.png",
            0x86 : "0x86.png",
            0x87 : "0x87.png",
            0x88 : "0x88.png",
            0x89 : "0x89.png",
            0x8a : "0x8a.png",
            0x8b : "0x8b.png",
            0x8c : "0x8c.png",
            0x8d : "0x8d.png",
            0x8e : "0x8e.png",
            0x8f : "0x8f.png",
            0x90 : "0x90.png",
            0x91 : "0x91.png",
            0x92 : "0x92.png",
            0x93 : "0x93.png",
            0x94 : "0x94.png",
            0x95 : "0x95.png",
            0x96 : "0x96.png",
            0x97 : "0x97.png",
            0x98 : "0x98.png",
            0x99 : "0x99.png",
            0x9a : "0x9a.png",
            0x9b : "0x9b.png",
            0x9c : "0x9c.png",
            0x9d : "0x9d.png",
            0x9e : "0x9e.png",
            0x9F : "0x9F.png",
            0xA0 : "0xA0.png",
            0xA1 : "0xA1.png",
            0xA2 : "0xA2.png",
            0xa3 : "0xa3.png",
            0xa4 : "0xa4.png",
            0xa5 : "0xa5.png",
            0xa6 : "0xa6.png",
            0xa7 : "0xa7.png",
            0xa8 : "0xa8.png",
            0xa9 : "0xa9.png",
            0xaa : "0xaa.png",
            0xab : "0xab.png",
            0xac : "0xac.png",
            0xad : "0xad.png",
            0xae : "0xae.png",
            0xaf : "0xaf.png",
            0xb0 : "0xb0.png",
            0xb1 : "0xb1.png",
            0xb2 : "0xb2.png",
            0xb3 : "0xb3.png",
            0xb4 : "0xb4.png",
            0xb5 : "0xb5.png"
        }

        for (var i in circuits) {
            var img = new Image();
            img.src = "Graphics/circuit/" + circuits[i];
            circuits[i] = img;
        }

        var circuitCanvas = document.getElementById("circuit");
        var context = circuitCanvas.getContext('2d');
        context.drawImage(circuits[15], 10, 10);
        
    </script>
    <input type="file" id="filereader" onchange="readBlob(this.files[0])" />
</body>
</html>
